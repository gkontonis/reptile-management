<div class="container mx-auto p-4 md:p-6">
  <!-- Breadcrumbs -->
  <div class="flex flex-wrap gap-2 mb-4 items-center text-sm">
    <a class="text-base-content/60 hover:text-primary cursor-pointer" (click)="onBack()">Animals</a>
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-base-content/40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
    </svg>
    @if (reptile(); as reptile) {
      <span class="font-medium">{{ reptile.name }} - {{ reptile.species }}</span>
    }
  </div>

  @if (loading()) {
    <div class="flex justify-center items-center h-64">
      <span class="loading loading-spinner loading-lg"></span>
    </div>
  } @else if (error()) {
    <div class="alert alert-error">
      <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span>{{ error() }}</span>
      <div>
        <button class="btn btn-sm btn-ghost" (click)="loadReptile(reptile()!.id)">Retry</button>
      </div>
    </div>
  } @else if (reptile(); as reptile) {

    <!-- Profile Header Card -->
    <div class="card bg-base-100 shadow-xl mb-6">
      <div class="card-body">
        <div class="flex flex-col md:flex-row gap-6 items-start justify-between">
          <div class="flex gap-4 md:gap-6 items-center">
            <!-- Profile Image -->
            <div class="avatar">
              <div class="w-24 md:w-32 rounded-xl ring ring-primary ring-offset-base-100 ring-offset-2">
                @if (getHighlightImageUrl()) {
                  <img [src]="getHighlightImageUrl()" [alt]="reptile.name" class="object-cover" />
                } @else {
                  <div class="bg-base-200 w-full h-full flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-base-content/30" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                  </div>
                }
              </div>
            </div>

            <!-- Name and Info -->
            <div class="flex flex-col">
              <div class="flex items-center gap-3 flex-wrap">
                <h1 class="text-2xl md:text-3xl font-bold">{{ reptile.name }}</h1>
                <span class="badge {{ getStatusBadgeClass(reptile.status) }} badge-lg font-bold">
                  {{ reptile.status }}
                </span>
              </div>
              <p class="text-base-content/60 text-lg">
                {{ reptile.species }}
                @if (reptile.subspecies) {
                  <span class="text-base-content/40">Â· {{ reptile.subspecies }}</span>
                }
                <span class="font-mono text-sm ml-2">ID: #{{ reptile.id }}</span>
              </p>
              <!-- Quick Stats -->
              <div class="flex gap-4 mt-3 flex-wrap">
                <div class="flex items-center gap-1 text-sm text-base-content/60">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                  Last Fed: {{ getDaysAgo(reptile.lastFedDate) }}
                </div>
                <div class="flex items-center gap-1 text-sm text-base-content/60">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                  Last Shed: {{ getDaysAgo(reptile.lastShedDate) }}
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex w-full md:w-auto gap-3">
            <button class="btn btn-outline flex-1 md:flex-none" (click)="onEdit()">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
              Edit Profile
            </button>
            <button class="btn btn-error btn-outline flex-1 md:flex-none" (click)="onDelete()">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs tabs-bordered mb-6">
      <a class="tab tab-lg" [class.tab-active]="activeTab() === 'overview'" (click)="setActiveTab('overview')">
        Overview
      </a>
      <a class="tab tab-lg" [class.tab-active]="activeTab() === 'feeding'" (click)="setActiveTab('feeding')">
        Feeding Logs
      </a>
      <a class="tab tab-lg" [class.tab-active]="activeTab() === 'health'" (click)="setActiveTab('health')">
        Health & Shed
      </a>
    </div>

    <!-- Tab Content -->
    <div class="flex flex-col lg:flex-row gap-6">

      <!-- Sidebar: Quick Specs -->
      <aside class="w-full lg:w-72 flex flex-col gap-4">
        <!-- Quick Specs Card -->
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <h3 class="card-title text-base">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              Quick Specs
            </h3>

            <div class="space-y-3 mt-2">
              <!-- Sex -->
              <div class="flex items-center gap-3 p-3 rounded-lg bg-base-200/50">
                <span class="text-xl">{{ getGenderIcon(reptile.gender) }}</span>
                <div>
                  <p class="text-[10px] uppercase text-base-content/50 font-bold">Sex</p>
                  <p class="text-sm font-medium">{{ reptile.gender === 'MALE' ? 'Male' : reptile.gender === 'FEMALE' ? 'Female' : 'Unknown' }}</p>
                </div>
              </div>

              <!-- Age -->
              <div class="flex items-center gap-3 p-3 rounded-lg bg-base-200/50">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 15.546c-.523 0-1.046.151-1.5.454a2.704 2.704 0 01-3 0 2.704 2.704 0 00-3 0 2.704 2.704 0 01-3 0 2.704 2.704 0 00-3 0 2.704 2.704 0 01-3 0 2.701 2.701 0 00-1.5-.454M9 6v2m3-2v2m3-2v2M9 3h.01M12 3h.01M15 3h.01M21 21v-7a2 2 0 00-2-2H5a2 2 0 00-2 2v7h18zm-3-9v-2a2 2 0 00-2-2H8a2 2 0 00-2 2v2h12z" />
                </svg>
                <div>
                  <p class="text-[10px] uppercase text-base-content/50 font-bold">Age</p>
                  <p class="text-sm font-medium">{{ getAge(reptile.birthDate) }}</p>
                </div>
              </div>

              <!-- Morph -->
              @if (reptile.morph) {
                <div class="flex items-center gap-3 p-3 rounded-lg bg-base-200/50">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                  </svg>
                  <div>
                    <p class="text-[10px] uppercase text-base-content/50 font-bold">Morph</p>
                    <p class="text-sm font-medium">{{ reptile.morph }}</p>
                  </div>
                </div>
              }

              <!-- Current Weight -->
              <div class="flex items-center gap-3 p-3 rounded-lg bg-base-200/50">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
                </svg>
                <div>
                  <p class="text-[10px] uppercase text-base-content/50 font-bold">Current Weight</p>
                  <p class="text-sm font-bold text-primary">
                    @if (reptile.weight) {
                      {{ reptile.weight }}g
                    } @else {
                      Unknown
                    }
                  </p>
                </div>
              </div>
            </div>

            <button class="btn btn-primary btn-sm w-full mt-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              Log New Weight
            </button>
          </div>
        </div>

        <!-- Activity Summary Card -->
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <h3 class="card-title text-base">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              Activity
            </h3>

            <div class="grid grid-cols-2 gap-3 mt-2">
              <div class="text-center p-3 rounded-lg bg-base-200/50">
                <p class="text-[10px] uppercase text-base-content/50 font-bold">Last Fed</p>
                <p class="text-sm font-medium">{{ reptile.lastFedDate ? (reptile.lastFedDate | date:'shortDate') : 'Never' }}</p>
              </div>
              <div class="text-center p-3 rounded-lg bg-base-200/50">
                <p class="text-[10px] uppercase text-base-content/50 font-bold">Last Shed</p>
                <p class="text-sm font-medium">{{ reptile.lastShedDate ? (reptile.lastShedDate | date:'shortDate') : 'Never' }}</p>
              </div>
              <div class="text-center p-3 rounded-lg bg-base-200/50">
                <p class="text-[10px] uppercase text-base-content/50 font-bold">Last Clean</p>
                <p class="text-sm font-medium">{{ reptile.lastCleanedDate ? (reptile.lastCleanedDate | date:'shortDate') : 'Never' }}</p>
              </div>
              <div class="text-center p-3 rounded-lg bg-base-200/50">
                <p class="text-[10px] uppercase text-base-content/50 font-bold">Acquired</p>
                <p class="text-sm font-medium">{{ reptile.acquisitionDate | date:'shortDate' }}</p>
              </div>
            </div>

            <button class="btn btn-primary btn-block mt-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              Log Activity
            </button>
          </div>
        </div>
      </aside>

      <!-- Main Content Area -->
      <div class="flex-1 space-y-6">

        @if (activeTab() === 'overview') {
          <!-- Details Card -->
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <h3 class="card-title">Details</h3>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                <div class="space-y-3">
                  @if (reptile.breeder) {
                    <div class="flex justify-between py-2 border-b border-base-200">
                      <span class="text-base-content/60">Breeder</span>
                      <span class="font-medium">{{ reptile.breeder }}</span>
                    </div>
                  }
                  @if (reptile.purchasePrice) {
                    <div class="flex justify-between py-2 border-b border-base-200">
                      <span class="text-base-content/60">Purchase Price</span>
                      <span class="font-medium">${{ reptile.purchasePrice }}</span>
                    </div>
                  }
                  @if (reptile.enclosureId) {
                    <div class="flex justify-between py-2 border-b border-base-200">
                      <span class="text-base-content/60">Enclosure</span>
                      <span class="font-medium">Enclosure #{{ reptile.enclosureId }}</span>
                    </div>
                  }
                </div>
                <div class="space-y-3">
                  <div class="flex justify-between py-2 border-b border-base-200">
                    <span class="text-base-content/60">Created</span>
                    <span class="font-medium">{{ reptile.createdAt | date:'mediumDate' }}</span>
                  </div>
                  <div class="flex justify-between py-2 border-b border-base-200">
                    <span class="text-base-content/60">Last Updated</span>
                    <span class="font-medium">{{ reptile.updatedAt | date:'mediumDate' }}</span>
                  </div>
                </div>
              </div>

              @if (reptile.notes) {
                <div class="mt-4">
                  <h4 class="font-semibold mb-2">Notes</h4>
                  <p class="text-base-content/80 whitespace-pre-wrap bg-base-200/30 p-4 rounded-lg">{{ reptile.notes }}</p>
                </div>
              }
            </div>
          </div>

          <!-- Recent Feeding History -->
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <div class="flex justify-between items-center">
                <h3 class="card-title">Recent Feeding History</h3>
                <button class="btn btn-primary btn-sm gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                  Log Feeding
                </button>
              </div>

              @if (feedingLogsLoading()) {
                <div class="flex justify-center py-8">
                  <span class="loading loading-spinner loading-md"></span>
                </div>
              } @else if (feedingLogs().length === 0) {
                <div class="text-center py-8 text-base-content/60">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-3 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                  <p>No feeding logs yet</p>
                  <p class="text-sm">Start tracking {{ reptile.name }}'s meals</p>
                </div>
              } @else {
                <div class="overflow-x-auto mt-4">
                  <table class="table table-zebra">
                    <thead>
                      <tr class="text-xs uppercase">
                        <th>Date</th>
                        <th>Food Type</th>
                        <th>Quantity</th>
                        <th>Notes</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (log of feedingLogs().slice(0, 5); track log.id) {
                        <tr class="hover">
                          <td class="text-sm">{{ log.feedDate | date:'mediumDate' }}</td>
                          <td class="text-sm font-medium">{{ log.foodType }}</td>
                          <td class="text-sm">{{ log.quantity }}</td>
                          <td class="text-sm text-base-content/60">{{ log.notes || '-' }}</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
                @if (feedingLogs().length > 5) {
                  <div class="text-center mt-4">
                    <button class="btn btn-ghost btn-sm" (click)="setActiveTab('feeding')">
                      View All Feeding Logs ({{ feedingLogs().length }})
                    </button>
                  </div>
                }
              }
            </div>
          </div>
        }

        @if (activeTab() === 'feeding') {
          <!-- Full Feeding Logs -->
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <div class="flex justify-between items-center">
                <h3 class="card-title">Feeding History</h3>
                <button class="btn btn-primary btn-sm gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                  Log Feeding
                </button>
              </div>

              @if (feedingLogsLoading()) {
                <div class="flex justify-center py-8">
                  <span class="loading loading-spinner loading-md"></span>
                </div>
              } @else if (feedingLogs().length === 0) {
                <div class="text-center py-12 text-base-content/60">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                  <p class="text-lg font-medium">No feeding logs yet</p>
                  <p class="text-sm">Start tracking {{ reptile.name }}'s meals</p>
                </div>
              } @else {
                <div class="overflow-x-auto mt-4">
                  <table class="table table-zebra">
                    <thead>
                      <tr class="text-xs uppercase">
                        <th>Date</th>
                        <th>Food Type</th>
                        <th>Quantity</th>
                        <th>Notes</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (log of feedingLogs(); track log.id) {
                        <tr class="hover">
                          <td class="text-sm">{{ log.feedDate | date:'mediumDate' }}</td>
                          <td class="text-sm font-medium">{{ log.foodType }}</td>
                          <td class="text-sm">{{ log.quantity }}</td>
                          <td class="text-sm text-base-content/60 max-w-xs truncate">{{ log.notes || '-' }}</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              }
            </div>
          </div>
        }

        @if (activeTab() === 'health') {
          <!-- Health & Shed Tab Content -->
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <h3 class="card-title">Health & Shedding</h3>
              <div class="text-center py-12 text-base-content/60">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                </svg>
                <p class="text-lg font-medium">Health tracking coming soon</p>
                <p class="text-sm">Shedding logs and health records will appear here</p>
              </div>
            </div>
          </div>
        }

        <!-- Photo Gallery (always visible) -->
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <div class="flex justify-between items-center">
              <h3 class="card-title">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                Photos ({{ images().length }})
              </h3>
              <button class="btn btn-primary btn-sm gap-1" (click)="openUploadModal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                Upload
              </button>
            </div>

            @if (imagesLoading()) {
              <div class="flex justify-center py-8">
                <span class="loading loading-spinner loading-md"></span>
              </div>
            } @else if (images().length === 0) {
              <div class="text-center py-12 text-base-content/60">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <p class="text-lg font-medium">No photos yet</p>
                <p class="text-sm">Upload photos of {{ reptile.name }}</p>
              </div>
            } @else {
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                @for (image of images(); track image.id) {
                  <div class="relative group">
                    <!-- Highlight Badge -->
                    @if (isHighlightImage(image.id)) {
                      <div class="absolute top-2 left-2 z-10">
                        <span class="badge badge-primary badge-sm gap-1">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                          </svg>
                          Highlight
                        </span>
                      </div>
                    }

                    <div class="aspect-square rounded-lg overflow-hidden bg-base-200 cursor-pointer ring-2 ring-transparent hover:ring-primary transition-all">
                      <img [src]="getImageUrl(image.id)" [alt]="image.description || image.filename"
                        class="w-full h-full object-cover transition-transform group-hover:scale-105" />
                    </div>
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center gap-2">
                      <a [href]="getImageUrl(image.id)" target="_blank" class="btn btn-circle btn-sm btn-ghost text-white" title="View full size">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                      </a>

                      <!-- Set as Highlight Button -->
                      @if (!isHighlightImage(image.id)) {
                        <button class="btn btn-circle btn-sm btn-primary" (click)="setAsHighlight(image.id)" title="Set as highlight image">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                          </svg>
                        </button>
                      } @else {
                        <button class="btn btn-circle btn-sm btn-warning" (click)="removeHighlight()" title="Remove highlight">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                          </svg>
                        </button>
                      }

                      <button class="btn btn-circle btn-sm btn-error" (click)="deleteImage(image.id)" title="Delete image">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                      </button>
                    </div>
                    <div class="mt-2 text-xs text-base-content/60 truncate">{{ image.filename }}</div>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Delete Confirmation Modal -->
  @if (showDeleteModal()) {
    <div class="modal modal-open">
      <div class="modal-box">
        <h3 class="font-bold text-lg mb-4">Confirm Deletion</h3>
        <div class="alert alert-warning mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
          <span>This action cannot be undone!</span>
        </div>
        @if (reptile(); as reptile) {
          <p class="py-4">
            Are you sure you want to delete <strong>{{ reptile.name }}</strong> ({{ reptile.species }})?
          </p>
          <p class="text-sm text-base-content/70 mb-4">
            All associated data including feeding logs, weight logs, and shedding records will be permanently removed.
          </p>
        }
        <div class="modal-action">
          <button class="btn btn-ghost" (click)="cancelDelete()" [disabled]="deleteLoading()">
            Cancel
          </button>
          <button class="btn btn-error" (click)="confirmDelete()" [disabled]="deleteLoading()">
            @if (deleteLoading()) {
              <span class="loading loading-spinner loading-sm"></span>
              Deleting...
            } @else {
              Delete Permanently
            }
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Edit Modal -->
  @if (showEditModal()) {
    <div class="modal modal-open">
      <div class="modal-box max-w-3xl max-h-[90vh] overflow-y-auto">
        <h3 class="font-bold text-lg mb-4">Edit Reptile</h3>

        <form [formGroup]="editForm" (ngSubmit)="onSubmitEdit()" class="space-y-4">
          <!-- Basic Information -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="form-control">
              <label class="label">
                <span class="label-text">Name *</span>
              </label>
              <input type="text" formControlName="name" class="input input-bordered input-sm"
                placeholder="Enter reptile name" [class.input-error]="getFieldError('name')" />
              @if (getFieldError('name')) {
                <label class="label">
                  <span class="label-text-alt text-error">{{ getFieldError('name') }}</span>
                </label>
              }
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">Species *</span>
              </label>
              <input type="text" formControlName="species" class="input input-bordered input-sm"
                placeholder="e.g., Ball Python, Bearded Dragon" [class.input-error]="getFieldError('species')" />
              @if (getFieldError('species')) {
                <label class="label">
                  <span class="label-text-alt text-error">{{ getFieldError('species') }}</span>
                </label>
              }
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="form-control">
              <label class="label">
                <span class="label-text">Subspecies</span>
              </label>
              <input type="text" formControlName="subspecies" class="input input-bordered input-sm"
                placeholder="Optional subspecies" />
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">Morph</span>
              </label>
              <input type="text" formControlName="morph" class="input input-bordered input-sm"
                placeholder="Optional morph" />
            </div>
          </div>

          <!-- Status and Gender -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="form-control">
              <label class="label">
                <span class="label-text">Gender *</span>
              </label>
              <select formControlName="gender" class="select select-bordered select-sm">
                @for (option of genderOptions; track option.value) {
                  <option [value]="option.value">{{ option.label }}</option>
                }
              </select>
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">Status *</span>
              </label>
              <select formControlName="status" class="select select-bordered select-sm">
                @for (option of statusOptions; track option.value) {
                  <option [value]="option.value">{{ option.label }}</option>
                }
              </select>
            </div>
          </div>

          <!-- Breeder and Purchase Info -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="form-control">
              <label class="label">
                <span class="label-text">Breeder</span>
              </label>
              <input type="text" formControlName="breeder" class="input input-bordered input-sm"
                placeholder="Optional breeder name" />
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">Purchase Price</span>
              </label>
              <input type="number" formControlName="purchasePrice" class="input input-bordered input-sm"
                placeholder="0.00" min="0" step="0.01" [class.input-error]="getFieldError('purchasePrice')" />
              @if (getFieldError('purchasePrice')) {
                <label class="label">
                  <span class="label-text-alt text-error">{{ getFieldError('purchasePrice') }}</span>
                </label>
              }
            </div>
          </div>

          <!-- Dates -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="form-control">
              <label class="label">
                <span class="label-text">Acquisition Date *</span>
              </label>
              <input type="date" formControlName="acquisitionDate" class="input input-bordered input-sm"
                [class.input-error]="getFieldError('acquisitionDate')" />
              @if (getFieldError('acquisitionDate')) {
                <label class="label">
                  <span class="label-text-alt text-error">{{ getFieldError('acquisitionDate') }}</span>
                </label>
              }
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">Birth Date</span>
              </label>
              <input type="date" formControlName="birthDate" class="input input-bordered input-sm" />
              <label class="label">
                <span class="label-text-alt">Optional - leave blank if unknown</span>
              </label>
            </div>
          </div>

          <!-- Enclosure ID -->
          <div class="form-control">
            <label class="label">
              <span class="label-text">Enclosure ID</span>
            </label>
            <input type="number" formControlName="enclosureId" class="input input-bordered input-sm"
              placeholder="Optional enclosure assignment" />
          </div>

          <!-- Notes -->
          <div class="form-control">
            <label class="label">
              <span class="label-text">Notes</span>
            </label>
            <textarea formControlName="notes" class="textarea textarea-bordered h-20"
              placeholder="Any additional notes about this reptile..."
              [class.textarea-error]="getFieldError('notes')"></textarea>
            @if (getFieldError('notes')) {
              <label class="label">
                <span class="label-text-alt text-error">{{ getFieldError('notes') }}</span>
              </label>
            }
          </div>

          <!-- Actions -->
          <div class="modal-action">
            <button type="button" class="btn btn-ghost" (click)="cancelEdit()" [disabled]="editLoading()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="editLoading() || editForm.invalid">
              @if (editLoading()) {
                <span class="loading loading-spinner loading-sm"></span>
                Saving...
              } @else {
                Save Changes
              }
            </button>
          </div>
        </form>
      </div>
      <form method="dialog" class="modal-backdrop">
        <button (click)="cancelEdit()">close</button>
      </form>
    </div>
  }

  <!-- Image Upload Modal -->
  @if (showUploadModal()) {
    <div class="modal modal-open">
      <div class="modal-box">
        <h3 class="font-bold text-lg mb-4">Upload Photo</h3>

        <div class="space-y-4">
          <!-- File Input -->
          <div class="form-control">
            <label class="label">
              <span class="label-text">Select Image *</span>
            </label>
            <input type="file" accept="image/jpeg,image/png,image/gif,image/webp,image/bmp"
              (change)="onFileSelected($event)" class="file-input file-input-bordered w-full" />
            <label class="label">
              <span class="label-text-alt">Supported formats: JPEG, PNG, GIF, WebP, BMP (max 10MB)</span>
            </label>
          </div>

          @if (selectedFile) {
            <div class="alert alert-info">
              <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <div>
                <span class="font-medium">{{ selectedFile.name }}</span>
                <span class="text-sm opacity-70">({{ formatFileSize(selectedFile.size) }})</span>
              </div>
            </div>
          }

          <!-- Description -->
          <div class="form-control">
            <label class="label">
              <span class="label-text">Description (optional)</span>
            </label>
            <textarea [(ngModel)]="imageDescription" class="textarea textarea-bordered h-20"
              placeholder="Add a description for this photo..."></textarea>
          </div>
        </div>

        <div class="modal-action">
          <button class="btn btn-ghost" (click)="cancelUpload()" [disabled]="uploadLoading()">
            Cancel
          </button>
          <button class="btn btn-primary" (click)="uploadImage()" [disabled]="uploadLoading() || !selectedFile">
            @if (uploadLoading()) {
              <span class="loading loading-spinner loading-sm"></span>
              Uploading...
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
              </svg>
              Upload
            }
          </button>
        </div>
      </div>
      <form method="dialog" class="modal-backdrop">
        <button (click)="cancelUpload()">close</button>
      </form>
    </div>
  }
</div>
